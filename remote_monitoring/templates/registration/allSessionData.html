{% extends 'registration/home.html' %}
{% load static %}

{% block session %} 


<div class="table-container">    

{% if messages %}
<h2>{{messages}}</h2>
       
 {% else %}
 <form method="get" action="">
 <div class="select-button-container">
    
    <select id="searchInput" name="machine_id" onchange="this.form.submit()">
        
        {% for machine in machines %}
        <option value="{{ machine.id }}" 
            {% if machine.id == default_machine_id %}selected{% endif %}> <!-- Set selected if machine_id matches -->
            {{ machine }}
        </option>
    {% endfor %}
    </select>
    <button id="downloadButton" class="download-button" name="download" value="true" type="submit">Download Reports Here</button>

    </div>
</form>

<script>
    document.getElementById("searchInput").addEventListener("change", function () {
        const machineId = this.value; // Get selected machine_id
        const downloadButton = document.getElementById("downloadButton");
        
        // Append the machine_id to the form's action dynamically
        const form = downloadButton.closest("form");
        const baseUrl = window.location.href.split("?")[0]; // Base URL
        form.action = `${baseUrl}?machine_id=${machineId}`;
    });
</script>

    <table>
        <thead>
            <tr>
                <th>Time Engaged</th>
                <th>Distance While Active</th>
                <th>Hand Position</th>
                <th>CPR Rate</th>
                <th>Compression</th>
                <th>Recoil</th>
                <th>Watched Animation</th>
                <th>Sessions played</th>
                <th>Survey Q1</th>
                <th>Survey Q2</th>
            </tr>
        </thead>
        <tbody>
            <!-- Example Row 1 -->
             {% for data in sessionData %}
            <tr>
                <td>{{data.time_engaged}}</td>
                <td>{{data.distance_while_active}}</td>
                <td>{{data.hand_position}}</td>  
                <td>{{data.rate }}</td>
                <td>{{data.compression}}</td>
                <td>{{data.recoil}}</td>
                <td>{{data.watched_animation}}</td>
                <td>{{data.sessions_played}}</td>
                <td>{{data.survey.question_1_response}}</td>
                <td>{{data.survey.question_2_response}}</td>     
            </tr>
            {% endfor %}

        </tbody>
    </table>

    <div class="pagination-controls">
        <span class="step-links">
            {% if sessionData.has_previous %}
                <a href="?page=1&machine_id={{ default_machine_id }}">&laquo; First</a>
                <a href="?page={{ sessionData.previous_page_number }}&machine_id={{ default_machine_id }}">Previous</a>
            {% endif %}
    
            <span class="current">
                Page {{ sessionData.number }} of {{ sessionData.paginator.num_pages }}
            </span>
    
            {% if sessionData.has_next %}
                <a href="?page={{ sessionData.next_page_number }}&machine_id={{ default_machine_id }}">Next</a>
                <a href="?page={{ sessionData.paginator.num_pages }}&machine_id={{ default_machine_id }}">Last &raquo;</a>
            {% endif %}
        </span>
    </div>
</div>

<!-- JavaScript for search functionality -->
<script>
    function searchTable() {
        // Get search input
        let input = document.getElementById("searchInput").value.toLowerCase();
        let table = document.getElementById("myTable");
        let tr = table.getElementsByTagName("tr");
    
        // Loop through all table rows
        for (let i = 1; i < tr.length; i++) {
            let row = tr[i];
            let textContent = row.textContent.toLowerCase();
            
            // If row matches the search query, show it. Otherwise, hide it.
            if (textContent.includes(input)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        }
    }
    </script>

{% endif %}


{% endblock %} 